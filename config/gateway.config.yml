http:
  port: ${PORT}
  hostname: 0.0.0.0
admin:
  port: ${ADMIN_PORT}
  hostname: 127.0.0.1

####### API ENDPOINTS DEFINITION ########
apiEndpoints:

####### ACCOUNT API PUBLIC ########
  accountPublic:  
    - host: '*'
      paths: ['/users/*/password']
      methods: ['PATCH']

####### ACCOUNT API PRIVATE ########
  accountPrivate:
    - host: '*'
      paths: ['/auth']
      methods: ['POST']

    - host: '*'
      paths: ['/users/admins']
      methods: ['POST']
      scopes: ['admin:create']

    - host: '*'
      paths: ['/users/healthprofessionals']
      methods: ['POST']
      scopes: ['healthprofessional:create'] 
    
    - host: '*'
      paths: ['/users/admins']
      methods: ['GET']
      scopes: ['admin:readAll']
    
    - host: '*'
      paths: ['/users/healthprofessionals']
      methods: ['GET']
      scopes: ['healthprofessional:readAll']

    - host: '*'
      paths: ['/users/admins/*']
      methods: ['GET']
      scopes: ['admin:read','admin:readAll']
    
    - host: '*'
      paths: ['/users/healthprofessionals/*']
      methods: ['GET']
      scopes: ['healthprofessional:read', 'healthprofessional:readAll']

    - host: '*'
      paths: ['/users/*']
      methods: ['DELETE']
      scopes: ['admin:delete','admin:deleteAll','healthprofessional:delete','healthprofessional:deleteAll']

    - host: '*'
      paths: ['/users/admins/*']
      methods: ['PATCH']
      scopes: ['admin:update','admin:updateAll']    
    
    - host: '*'
      paths: ['/users/healthprofessionals/*']
      methods: ['PATCH']
      scopes: ['healthprofessional:update', 'healthprofessional:updateAll']    
  

####### SERVICE ENDPOINTS DEFINITIONS ########
serviceEndpoints:
  accountService:
    url: ${ACCOUNT_SERVICE}

####### POLICIES USED IN PIPELINES DEFINITION ########
policies:
  - log
  - proxy
  - rate-limit
  - haniot-jwtScopes-policy
  - haniot-jwt-policy
  - haniot-auth-policy
  - haniot-body-parser-policy
  - haniot-delete-user-policy
####### PIPELINES DEFINITION ########
#### Pipeline no manage data coming from ACCOUNT PRIVATE and PUBLIC APIs ####

pipelines:
  - name: privatePipeline
    apiEndpoints:
      - accountPrivate
    policies: 
      - haniot-body-parser-policy:     
      - haniot-auth-policy:
        - 
          condition:
            name: 'is-auth'
            authpath: '/auth'
          action:
            urlauthservice: ${ACCOUNT_SERVICE}/auth
            secretOrPublicKey: ${SECRET_JWT}
            issuer: ${ISSUER}
      - haniot-jwt-policy:
          - action:
              secretOrPublicKey: ${SECRET_JWT}
              issuer: ${ISSUER}
      - haniot-jwtScopes-policy:
      - haniot-delete-user-policy:
        - 
          condition:
            name: 'is-delete'
            #deletepath é uma expressão regular
            deletepath: '^(\/users\/)[a-fA-F0-9]{24}$'
          action:
            urldeleteservice: ${ACCOUNT_SERVICE}/users            
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true 
              serviceEndpoint: accountService

  - name: publicPipeline
    apiEndpoints:
      - accountPublic
    policies:       
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true 
              serviceEndpoint: accountService 